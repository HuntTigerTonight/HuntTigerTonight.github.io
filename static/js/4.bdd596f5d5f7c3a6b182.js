webpackJsonp([4],{"84ra":function(e,t){},EbSZ:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("mvHQ"),a=i.n(n),l=i("woOf"),o=i.n(l),s=i("Dd8w"),r=i.n(s),c=i("Rly4"),d=i("NYxO"),u={data:function(){return{name:"",role:{},dialogVisible:!1,pageSize:20,currentPage:1,treeMenu:[],roleMenus:[],identities:[],permissionId:"",defaultProps:{children:"children",label:"text"},dialogAdd:!1,dialogEdit:!1,formLabelWidth:"120px",Info:{name:"",code:"",remark:"",hospitalId:null},height:document.documentElement.clientHeight-242,rules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],hospitalId:[{type:"number",required:!0,message:"请选择所属医院",trigger:"blur"}]}}},computed:r()({},Object(d.c)(["hospitalList","hospitalObj","isSuperAdmin","hospitalIdBelongsAccount"])),methods:{getLists:function(){var e=this;Object(c.a)("get","role/roles",{limit:this.pageSize,page:this.currentPage,filters:[{property:"name",value:this.name,operation:"ALIKE"}]}).then(function(t){e.role=t})},sizeChange:function(e){this.pageSize=e,this.getLists()},currentChange:function(e){if(this.currentPage==e)return!1;this.currentPage=e,this.getLists()},conditionalQuery:function(){this.getLists()},hospital:function(e){return this.hospitalObj[e.hospitalId]},add:function(){o()(this.$data.Info,this.$options.data().Info),this.Info.hospitalId=this.hospitalIdBelongsAccount,this.dialogAdd=!0},addSave:function(){var e=this;this.$refs.ruleFormAdd.validate(function(t){if(!t)return!1;Object(c.a)("post","role",e.Info).then(function(t){e.dialogAdd=!1,e.$message({type:"success",message:"角色添加成功!"}),e.getLists()})})},edit:function(e){this.dialogEdit=!0,this.Info=JSON.parse(a()(e.row))},editSave:function(){var e=this;this.$refs.ruleFormEdit.validate(function(t){if(!t)return!1;Object(c.a)("put","role/"+e.Info.id,e.Info).then(function(t){e.dialogEdit=!1,e.$message({type:"success",message:"角色编辑成功!"}),e.getLists()})})},delete:function(e){var t=this;Object(c.a)("DELETE","role/"+e).then(function(e){t.$message({type:"success",message:"删除成功!"}),t.getLists()})},deleteRow:function(e){var t=this;this.$confirm("此操作将永久删除该条数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.delete(e.row.id)}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},permission:function(e){var t=this;this.permissionId=e.row.id,this.dialogVisible=!0,this.identities=[],this.roleMenus=[],this.treeMenu=[],Object(c.a)("GET","role/authorization/"+e.row.id).then(function(e){e.data.identities.forEach(function(e,i){t.identities.push(e.id)});var i=[],n=[];e.data.menus.forEach(function(e,t){null===e.parentId&&i.push(e),i.forEach(function(t,i){e.parentId===t.id&&t.children.push(e),t.children.forEach(function(t,i){e.parentId===t.id&&(t.children.push(e),n.push(e.id))})})}),e.data.menus.forEach(function(e,t){e.children&&0!=e.children.length?e.children.forEach(function(e,t){e.children&&0!=e.children.length||n.push(e.id)}):n.push(e.id)}),e.data.roleMenus.forEach(function(e,i){n.indexOf(e.menuId)>-1&&t.roleMenus.push(e.menuId)}),t.treeMenu=i})},getCheckedKeys:function(){this.roleMenus=this.$refs.tree.getCheckedKeys()},permissionSave:function(){var e=this;this.getCheckedKeys();var t=this.roleMenus.join(",");Object(c.a)("PUT","role/authorization/"+this.permissionId,{mids:t,identities:this.identities.join(",")}).then(function(t){e.dialogVisible=!1,e.$message({message:"编辑成功",type:"success"})})}},created:function(){this.getLists()}},f={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"search_box"},[i("table",[i("tr",[i("td",[i("label",[e._v("角色名称：")]),e._v(" "),i("el-input",{attrs:{placeholder:"请输入角色名称",name:"name",size:"small","suffix-icon":"el-icon-edit-outline",clearable:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),i("td",[i("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return t.preventDefault(),e.conditionalQuery(t)}}},[i("span",{staticClass:"el-icon-search"}),e._v(" "),i("span",[e._v("查询")])]),e._v(" "),e.common.permissions("/role")?i("el-button",{staticStyle:{backgorund:"#eef1f6"},attrs:{size:"small",type:"success"},on:{click:function(t){return t.preventDefault(),e.add(t)}}},[i("span",{staticClass:"el-icon-plus"}),e._v(" "),i("span",[e._v("新增")])]):e._e()],1)])])]),e._v(" "),i("div",{staticStyle:{margin:"0 auto"}},[i("div",{staticClass:"table_data"},[i("el-table",{attrs:{stripe:!0,data:e.role.data,border:"","max-height":e.height}},[i("el-table-column",{attrs:{type:"index",label:"序号","header-align":"center",align:"center",width:"65"}}),e._v(" "),i("el-table-column",{attrs:{prop:"name",label:"角色名称","header-align":"center",align:"center","min-width":"160"}}),e._v(" "),i("el-table-column",{attrs:{prop:"code",label:"角色代码","header-align":"center",align:"center","min-width":"160"}}),e._v(" "),e.isSuperAdmin||"666666"==e.hospitalIdBelongsAccount?i("el-table-column",{attrs:{formatter:e.hospital,label:"所属医院","header-align":"center",align:"center","min-width":"200"}}):e._e(),e._v(" "),i("el-table-column",{attrs:{prop:"remark",label:"角色说明","header-align":"center",align:"center","min-width":"340"}}),e._v(" "),i("el-table-column",{attrs:{label:"操作","header-align":"center",align:"center",width:"240",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return null!=t.row.hospitalId||e.isSuperAdmin?[e.common.permissions("/role/[0-9]{0,9}")?i("el-button",{attrs:{type:"primary",size:"small"},nativeOn:{click:function(i){i.preventDefault(),e.edit(t)}}},[e._v("\n              编辑\n            ")]):e._e(),e._v(" "),e.common.permissions("/role/authorization/[0-9]{0,9}")?i("el-button",{attrs:{type:"success",size:"small"},nativeOn:{click:function(i){i.preventDefault(),e.permission(t)}}},[e._v("\n              权限设定\n            ")]):e._e(),e._v(" "),e.common.permissions("DELETE@/role/[0-9]{0,9}")?i("el-button",{attrs:{type:"danger",size:"small"},nativeOn:{click:function(i){i.preventDefault(),e.deleteRow(t)}}},[e._v("\n              删除\n            ")]):e._e()]:void 0}}])})],1)],1),e._v(" "),i("div",{staticClass:"block",staticStyle:{"text-align":"center",border:"1px solid #e4e4e4",background:"#eef1f6"}},[i("el-pagination",{attrs:{"page-sizes":[10,20,30,40,50,100,200],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.role.total},on:{"size-change":e.sizeChange,"current-change":e.currentChange}})],1)]),e._v(" "),i("el-dialog",{attrs:{title:"新增角色",visible:e.dialogAdd,width:"600px"},on:{"update:visible":function(t){e.dialogAdd=t}}},[i("el-form",{ref:"ruleFormAdd",attrs:{model:e.Info,rules:e.rules}},[i("el-form-item",{attrs:{label:"角色名称","label-width":e.formLabelWidth,prop:"name"}},[i("el-input",{staticStyle:{width:"250px"},attrs:{placeholder:"请输入角色名称",name:"name",size:"small","suffix-icon":"el-icon-edit-outline","auto-complete":"off"},model:{value:e.Info.name,callback:function(t){e.$set(e.Info,"name",t)},expression:"Info.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"角色代码","label-width":e.formLabelWidth}},[i("el-input",{staticStyle:{width:"250px"},attrs:{placeholder:"请输入角色代码",name:"code",size:"small","suffix-icon":"el-icon-edit-outline","auto-complete":"off"},model:{value:e.Info.code,callback:function(t){e.$set(e.Info,"code",t)},expression:"Info.code"}})],1),e._v(" "),e.isSuperAdmin?i("el-form-item",{attrs:{label:"所属医院","label-width":e.formLabelWidth,prop:"hospitalId"}},[i("el-select",{staticStyle:{width:"250px"},attrs:{placeholder:"请选择所属医院",size:"small",name:"hospitalName",clearable:"",filterable:""},model:{value:e.Info.hospitalId,callback:function(t){e.$set(e.Info,"hospitalId",e._n(t))},expression:"Info.hospitalId"}},e._l(e.hospitalList,function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})}))],1):e._e(),e._v(" "),i("el-form-item",{attrs:{label:"说明","label-width":e.formLabelWidth}},[i("el-input",{staticStyle:{width:"250px"},attrs:{placeholder:"请输入说明",type:"textarea",name:"remark",size:"small","suffix-icon":"el-icon-edit-outline","auto-complete":"off"},model:{value:e.Info.remark,callback:function(t){e.$set(e.Info,"remark",t)},expression:"Info.remark"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){t.preventDefault(),e.dialogAdd=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return t.preventDefault(),e.addSave(t)}}},[e._v("确 定")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"编辑角色",visible:e.dialogEdit,width:"600px"},on:{"update:visible":function(t){e.dialogEdit=t}}},[i("el-form",{ref:"ruleFormEdit",attrs:{model:e.Info,rules:e.rules}},[i("el-form-item",{attrs:{label:"角色名称","label-width":e.formLabelWidth,prop:"name"}},[i("el-input",{staticStyle:{width:"250px"},attrs:{placeholder:"请输入角色名称",name:"name",size:"small","suffix-icon":"el-icon-edit-outline","auto-complete":"off"},model:{value:e.Info.name,callback:function(t){e.$set(e.Info,"name",t)},expression:"Info.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"角色代码","label-width":e.formLabelWidth}},[i("el-input",{staticStyle:{width:"250px"},attrs:{placeholder:"请输入角色代码",name:"code",size:"small","suffix-icon":"el-icon-edit-outline","auto-complete":"off"},model:{value:e.Info.code,callback:function(t){e.$set(e.Info,"code",t)},expression:"Info.code"}})],1),e._v(" "),e.isSuperAdmin?i("el-form-item",{attrs:{label:"所属医院","label-width":e.formLabelWidth,prop:"hospitalId"}},[i("el-select",{staticStyle:{width:"250px"},attrs:{placeholder:"请选择所属医院",size:"small",clearable:"",filterable:""},model:{value:e.Info.hospitalId,callback:function(t){e.$set(e.Info,"hospitalId",e._n(t))},expression:"Info.hospitalId"}},e._l(e.hospitalList,function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})}))],1):e._e(),e._v(" "),i("el-form-item",{attrs:{label:"说明","label-width":e.formLabelWidth}},[i("el-input",{staticStyle:{width:"250px"},attrs:{placeholder:"请输入说明",type:"textarea",name:"remark",size:"small","suffix-icon":"el-icon-edit-outline","auto-complete":"off"},model:{value:e.Info.remark,callback:function(t){e.$set(e.Info,"remark",t)},expression:"Info.remark"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){t.preventDefault(),e.dialogEdit=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return t.preventDefault(),e.editSave(t)}}},[e._v("确 定")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"权限设置（注：勾选 “增”、“删”、“改” 操作,相应的查看操作会看默认勾选）",visible:e.dialogVisible,width:"800px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-tree",{ref:"tree",staticClass:"menu_tree",attrs:{data:e.treeMenu,props:e.defaultProps,"show-checkbox":"",accordion:!0,"default-checked-keys":e.roleMenus,"node-key":"id"}}),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){t.preventDefault(),e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){return t.preventDefault(),e.permissionSave(t)}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var p=i("VU/8")(u,f,!1,function(e){i("84ra")},null,null);t.default=p.exports},mvHQ:function(e,t,i){e.exports={default:i("qkKv"),__esModule:!0}},qkKv:function(e,t,i){var n=i("FeBl"),a=n.JSON||(n.JSON={stringify:JSON.stringify});e.exports=function(e){return a.stringify.apply(a,arguments)}}});