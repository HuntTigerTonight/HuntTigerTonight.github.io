webpackJsonp([20],{HYsA:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=t("Dd8w"),i=t.n(a),l=t("Rly4"),n=t("NYxO"),o=t("PJh5"),r=t.n(o),c={data:function(){return{message:{value:null},messageByReply:{replyValue:null},pageSize:10,currentPage:1,total:0,parentMessageList:[],childMessageList:[],showReply:null,rules:{value:[{required:!0,message:"请输入留言内容",trigger:"blur"}]},rulesReply:{replyValue:[{required:!0,message:"请输入回复内容",trigger:"blur"}]}}},computed:i()({},Object(n.c)(["userName","hospitalIdBelongsAccount","hospitalObj"])),methods:{getParentMessageList:function(){var e=this;Object(l.a)("get","hospitalMessage/hospitalMessages",{limit:this.pageSize,page:this.currentPage}).then(function(s){e.total=s.total,e.parentMessageList=s.data,document.querySelector(".communicateArea").scrollTop=0})},getChildMessageList:function(e){var s=this;this.childMessageList=[],Object(l.a)("get","hospitalMessage/getByParentId/"+e.id).then(function(e){s.childMessageList=e.data})},leaveMessage:function(){var e=this;this.$refs.ruleForm.validate(function(s){if(!s)return!1;Object(l.a)("post","hospitalMessage",{accountName:e.userName,message:e.message.value,hospitalId:e.hospitalIdBelongsAccount,hospitalName:e.hospitalIdBelongsAccount?e.hospitalObj[e.hospitalIdBelongsAccount]:"超级管理员",messageDate:r()(new Date).format("YYYY-MM-DD hh:mm:ss")}).then(function(s){e.$message({showClose:!0,message:"留言成功",type:"success",duration:"1000"}),e.message.value=null,e.getParentMessageList()})})},replyMessage:function(e){var s=this;Object(l.a)("post","hospitalMessage",{accountName:this.userName,message:this.messageByReply.replyValue,hospitalId:this.hospitalIdBelongsAccount,hospitalName:this.hospitalIdBelongsAccount?this.hospitalObj[this.hospitalIdBelongsAccount]:"超级管理员",messageDate:r()(new Date).format("YYYY-MM-DD hh:mm:ss"),parentMessageId:e.id}).then(function(t){e.childCount++,s.getChildMessageList(e),s.messageByReply.replyValue=null})},doReply:function(e){this.showReply==e.id?this.showReply=null:(this.showReply=e.id,this.getChildMessageList(e))},replySave:function(e){var s=this;this.$refs.ruleFormReply[0].validate(function(t){if(!t)return!1;s.replyMessage(e)})},doDelete:function(e){var s=this;Object(l.a)("delete","hospitalMessage/"+e.id).then(function(e){s.getParentMessageList()})},sizeChange:function(e){this.pageSize=e,this.getParentMessageList()},currentChange:function(e){if(this.currentPage==e)return!1;this.currentPage=e,this.getParentMessageList()}},created:function(){this.getParentMessageList()}},u={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"communicateArea"},[e.common.permissions("POST@/hospitalMessage")?t("div",{staticClass:"communicateInput"},[e._m(0),e._v(" "),t("el-form",{ref:"ruleForm",attrs:{model:e.message,rules:e.rules}},[t("el-form-item",{attrs:{prop:"value"}},[t("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入内容，不得超过200字",maxlength:200},model:{value:e.message.value,callback:function(s){e.$set(e.message,"value",s)},expression:"message.value"}})],1)],1),e._v(" "),t("div",{staticClass:"communicateButton"},[t("el-button",{attrs:{type:"primary"},on:{click:function(s){return s.preventDefault(),e.leaveMessage(s)}}},[e._v("留言")])],1)],1):e._e(),e._v(" "),t("div",{staticClass:"communicateContent"},[t("ul",e._l(e.parentMessageList,function(s,a){return t("li",{key:a,staticClass:"pmessage"},[t("div",{staticClass:"clearfixed"},[t("div",{staticClass:"item-left fl"},[t("span",{staticClass:"item-hospitalname"},[e._v(e._s(s.hospitalName))]),e._v(" "),t("span",{staticClass:"item-messagedate"},[e._v(e._s(s.messageDate))])]),e._v(" "),t("div",{staticClass:"item-right fr"},[t("span",{on:{click:function(t){t.preventDefault(),e.doReply(s)}}},[t("span",[e._v("回复")]),e._v(" "),t("span",{staticStyle:{color:"red"}},[e._v("("+e._s(s.childCount?s.childCount:0)+")")])]),e._v(" "),e.common.permissions("DELETE@/hospatalMessage/[0-9]{0,9}")?t("span",{staticClass:"item-delete",on:{click:function(t){t.preventDefault(),e.doDelete(s)}}},[e._v("删除")]):e._e()])]),e._v(" "),t("div",{staticClass:"item-message"},[e._v(e._s(s.message))]),e._v(" "),e.showReply==s.id?t("div",{staticClass:"cmessageBox"},[t("ul",e._l(e.childMessageList,function(s,a){return t("li",{key:a,staticClass:"cmessage"},[t("div",[t("span",{staticClass:"item-hospitalname"},[e._v(e._s(s.hospitalName))]),e._v(" "),t("span",{staticClass:"item-messagedate"},[e._v(e._s(s.messageDate))])]),e._v(" "),t("div",[e._v(e._s(s.message))])])})),e._v(" "),t("div",{staticClass:"sureReply"},[t("el-form",{ref:"ruleFormReply",refInFor:!0,attrs:{model:e.messageByReply,rules:e.rulesReply}},[t("el-form-item",{attrs:{prop:"replyValue"}},[t("el-input",{staticStyle:{width:"100%"},attrs:{size:"small",placeholder:"我说：",autofocus:!0,maxlength:200},model:{value:e.messageByReply.replyValue,callback:function(s){e.$set(e.messageByReply,"replyValue",s)},expression:"messageByReply.replyValue"}})],1)],1),e._v(" "),t("el-button",{staticClass:"sureButton",attrs:{type:"primary",size:"small"},on:{click:function(t){t.preventDefault(),e.replySave(s)}}},[e._v("确认")])],1)]):e._e()])})),e._v(" "),t("div",{staticClass:"footPage",staticStyle:{"text-align":"center",border:"1px solid #e4e4e4",background:"#eef1f6"}},[t("el-pagination",{attrs:{"page-sizes":[5,10,20,30,40,50],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.sizeChange,"current-change":e.currentChange}})],1)])])},staticRenderFns:[function(){var e=this.$createElement,s=this._self._c||e;return s("div",{staticClass:"message-title"},[s("span",{staticClass:"el-icon-message"}),this._v(" "),s("span",[this._v("交流区")])])}]};var p=t("VU/8")(c,u,!1,function(e){t("Hpgv")},"data-v-0e1522a0",null);s.default=p.exports},Hpgv:function(e,s){}});